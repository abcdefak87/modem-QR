<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Scan QR/Barcode</title>
<style>
    #reader { width: 500px; margin: auto; }
    .ok { color: green; font-weight: bold; }
    .err { color: red; font-weight: bold; }
</style>
</head>
<body>

<h2 style="text-align:center">Scan Barang</h2>
<div id="reader"></div>
<div id="msg" style="text-align:center; margin-top:10px;">üîç Arahkan kamera ke kode...</div>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzj4Pb1VF2C9AmddFLNUSjb4g-yCI951uWEbk9j-a4pJ6neDEgExjI6gCJkNKlks3zd/exec"; // URL Apps Script

function kirimData(nama) {
    document.getElementById("msg").innerHTML = `üì§ Mengirim: ${nama}...`;
    fetch(scriptURL, {
        method: "POST",
        body: new URLSearchParams({ nama: nama })
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "OK") {
            document.getElementById("msg").innerHTML = `<span class="ok">‚úÖ ${nama} ditambah 1</span>`;
        } else {
            document.getElementById("msg").innerHTML = `<span class="err">‚ùå Gagal</span>`;
        }
    })
    .catch(err => {
        document.getElementById("msg").innerHTML = `<span class="err">‚ö†Ô∏è Error: ${err}</span>`;
    });
}

function onScanSuccess(decodedText) {
    kirimData(decodedText);
}

const html5QrCode = new Html5Qrcode("reader");
Html5Qrcode.getCameras().then(cameras => {
    if (cameras && cameras.length) {
        html5QrCode.start(
            cameras[0].id, // pilih kamera pertama
            { fps: 10, qrbox: 250 },
            onScanSuccess
        );
    }
}).catch(err => {
    document.getElementById("msg").innerHTML = `<span class="err">‚ö†Ô∏è Kamera gagal dibuka</span>`;
});
</script>

</body>
</html>
